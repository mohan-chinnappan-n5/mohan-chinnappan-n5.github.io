<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>HAR Viz</title>
    

    <script src="https://mohan-chinnappan-n5.github.io/pkg/js/lib/autocomplete.min.js"></script>
    <link rel="stylesheet" href="https://mohan-chinnappan-n5.github.io/pkg/css/lib/autocomplete.css">
    <!-- Include D3.js and Monaco Editor libraries -->
    <script src="https://d3js.org/d3.v7.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/monaco-editor/0.24.0/min/vs/loader.js"></script>
    <link rel="icon" type="image/x-icon" href="https://mohan-chinnappan-n5.github.io/editor/img/favicon.ico" />

    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.5.3/dist/css/bootstrap.min.css"
        integrity="sha384-TX8t27EcRE3e/ihU7zmQxVncDAy5uIKz4rEkgIXeMed4M0jlfIDPvg6uqKI2xXr2" crossorigin="anonymous">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.6.0/jquery.min.js"
        integrity="sha512-894YE6QWD5I59HgZOGReFYm4dnWc1Qt5NtvYSaNcOP+u1T9qYdvdihz0PPSiiqn/+/3e7Jo4EaG7TubfWGUrMQ=="
        crossorigin="anonymous" referrerpolicy="no-referrer"></script>
    <script src="https://cdn.jsdelivr.net/npm/popper.js@1.16.1/dist/umd/popper.min.js"
        integrity="sha384-9/reFTGAW83EW2RDu2S0VKaIzap3H66lZH81PoYlFhbGU+6BZp6G7niu735Sk7lN"
        crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@4.5.3/dist/js/bootstrap.min.js"
        integrity="sha384-w1Q4orYjBQndcko6MimVbzY0tgp4pWB4lZ7lr30WKz0vr/aWKhXdBNmNb5D92v7s"
        crossorigin="anonymous"></script> 

    <style>
        body {
            margin: 0;
            display: flex;
            height: 100vh;
        }

        #editor {
            flex: 1;
            height: 100%;
            border: 1px solid #ccc;
        }

        #visualization {
            flex: 1;
            height: 100%;
            padding: 10px;
        }

        svg {
            width: 100%;
            height: 100%;
        }
    </style>
</head>
<body>

   

    <div id="editor"></div>
    <div id="visualization">
        <svg></svg>
    </div>

    <script>
        require.config({ paths: { 'vs': 'https://cdnjs.cloudflare.com/ajax/libs/monaco-editor/0.27.0/min/vs' } });
        require(['vs/editor/editor.main'], function () {
            // Initialize Monaco Editor
            var editor = monaco.editor.create(document.getElementById('editor'), {
                value: `{"message": "Place your har file content here"}`,
                language: "json",
                theme: "vs-dark"
            });

            // Function to update visualization
            function updateVisualization() {
                var harContent = editor.getValue();
                var harData = JSON.parse(harContent);

                // Clear the previous visualization
                var visualization = d3.select('svg');
                visualization.selectAll('*').remove();

                // Extract network requests from the HAR data
                var entries = harData.log.entries;

                // Calculate the start and end times for the requests
                var minStartTime = Number.MAX_VALUE;
                var maxEndTime = 0;

                entries.forEach(function (entry) {
                    var startTime = entry.startedDateTime ? new Date(entry.startedDateTime).getTime() : 0;
                    var endTime = startTime + entry.time;

                    minStartTime = Math.min(minStartTime, startTime);
                    maxEndTime = Math.max(maxEndTime, endTime);
                });

                // Create the x and y scales for the chart
                var svgWidth = document.getElementById('visualization').offsetWidth;
                var svgHeight = 300;

                var xScale = d3.scaleLinear()
                    .domain([minStartTime, maxEndTime])
                    .range([10, svgWidth - 10]);

                var yScale = d3.scaleBand()
                    .domain(entries.map(function (entry, index) { return "Request " + (index + 1); }))
                    .range([10, svgHeight - 10]);

                // Create rectangles for each request (representing request duration)
                visualization.selectAll("rect")
                    .data(entries)
                    .enter()
                    .append("rect")
                    .attr("x", function (d) { return xScale(new Date(d.startedDateTime).getTime()); })
                    .attr("y", function (d, i) { return yScale("Request " + (i + 1)); })
                    .attr("width", function (d) { return xScale(d.time); })
                    .attr("height", yScale.bandwidth())
                    .attr("fill", "lightblue");

                // Add labels for request durations
                visualization.selectAll("text")
                    .data(entries)
                    .enter()
                    .append("text")
                    .text(function (d) { return d.time + " ms"; })
                    .attr("x", function (d) { return xScale(new Date(d.startedDateTime).getTime()) + xScale(d.time) + 5; })
                    .attr("y", function (d, i) { return yScale("Request " + (i + 1)) + yScale.bandwidth() / 2; })
                    .attr("dy", "0.35em");

                // Add axis labels
                visualization.append("g")
                    .attr("transform", "translate(0," + (svgHeight - 20) + ")")
                    .call(d3.axisBottom(xScale).tickFormat(d3.format(".2s")));

                visualization.append("text")
                    .attr("x", svgWidth / 2)
                    .attr("y", svgHeight - 5)
                    .style("text-anchor", "middle")
                    .text("Time (ms)");
            }

            // Listen for changes in the editor content
            editor.onDidChangeModelContent(updateVisualization);

            // Initialize visualization
            //updateVisualization();
        });
    </script>
</body>
</html>
